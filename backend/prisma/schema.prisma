generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["prismaSchemaFolder"]
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String               @id @default(uuid())
  name               String               @db.VarChar(100)
  lastName           String?              @db.VarChar(100)
  phoneNumber        String               @unique @db.VarChar(20)
  score              Int?                 @default(100)
  rate               Int?                 @default(0)
  birthday           DateTime?
  role               String               @default("ADMIN")
  description        String?              @db.VarChar(200)
  password           String               @db.VarChar(60)
  refreshToken       String?
  calendar           Calendar[]
  category           Category[]
  categoryOperations CategoryOperations[]
  createdRoles       CustomRole[]
  directs            Directs[]
  income_Expanses    Income_Expanses[]
  settings           Settings?
}

model CustomRole {
  id     String @id @default(uuid())
  name   String @db.VarChar(100)
  userId String @db.VarChar(100)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Settings {
  id               String @id @default(uuid())
  defaultWorkTime  String @default("09:00-16:00")
  defaultBreakTime String @default("00:30")
  timeGranularity  String @default("00:30")
  userId           String @unique
  user             User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Calendar {
  id        String     @id @default(uuid())
  date      DateTime   @db.Date
  time      String?
  state     DayState   @default(empty)
  userId    String
  creator   User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  directs   Directs[]
  freeSlots FreeSlot[]

  @@unique([date, userId])
}

model FreeSlot {
  id         String   @id @default(uuid())
  time       String
  calendarId String
  isBooked   Boolean  @default(false)
  calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([calendarId, time])
}

model Directs {
  id         String            @id @default(uuid())
  phone      String?
  clientName String?
  time       String
  comment    String?
  userId     String?
  state      DirectsState?     @default(notConfirmed)
  calendarId String
  calendar   Calendar          @relation(fields: [calendarId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user       User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  services   DirectsServices[]

  @@index([calendarId])
}

model Income_Expanses {
  id                 String             @id @default(uuid())
  categoryId         String
  type               TypeOperation
  value              Float
  createDate         DateTime?          @default(now())
  updateDate         DateTime?
  userId             String
  categoryOperations CategoryOperations @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model CategoryOperations {
  id              String            @id @default(uuid())
  name            String
  userId          String
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  income_Expanses Income_Expanses[]
}

model Category {
  id       String     @id @default(uuid())
  name     String     @db.VarChar(100)
  userId   String
  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  services Services[]
}

model Services {
  id         String            @id @default(uuid())
  name       String            @db.VarChar(100)
  time       String
  price      Float
  categoryId String
  directs    DirectsServices[]
  category   Category          @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model DirectsServices {
  serviceId String
  directId  String
  direct    Directs  @relation(fields: [directId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  service   Services @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@id([directId, serviceId])
  @@index([directId, serviceId])
}

enum TypeOperation {
  income
  expense
}

enum DirectsState {
  notConfirmed
  confirmed
  cancelled
}

enum DayState {
  empty
  full
  have
  notHave
}

enum Role {
  CLIENT
  ADMIN
  EMPLOYE
}
