generator client {
  provider        = "prisma-client-js"
  binaryTargets   = ["native", "linux-musl-openssl-3.0.x"]
  previewFeatures = ["prismaSchemaFolder"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String            @id @default(uuid())
  name               String            @db.VarChar(100)
  lastName           String?           @db.VarChar(100)
  phoneNumber        String            @unique @db.VarChar(20)
  score              Int?              @default(100)
  rate               Int?              @default(0)
  birthday           DateTime?
  description        String?           @db.VarChar(200)
  password           String            @db.VarChar(60)
  role               Role              @default(CLIENT)
  calendar           Calendar[]
  refreshToken       String?
  directs            Directs[]
  categoryOperations CategoryOperations[]
  category           Category[]
  income_Expanses    Income_Expanses[]
  settings           Settings[]
}

model Settings {
    id                  String    @id @default(uuid())
    defaultWorkTime     String    @default("09:00-16:00")
    defaultBreakTime    String    @default("00:30")
    timeGranularity     String    @default("00:30")
    settingsData        Json
    userId              String    @unique
    user                User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Calendar {
  id        String      @id @default(uuid())
  date      DateTime    @db.Date
  directs   Directs[]
  time      String?
  state     DayState    @default(empty)
  userId    String
  creator   User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  freeSlots FreeSlot[]

  @@unique([date, userId])
}

model FreeSlot {
  id         String   @id @default(uuid())
  time       String
  calendar   Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  calendarId String
  isBooked   Boolean  @default(false)

  @@unique([calendarId, time])
}

model Directs {
  id         String            @id @default(uuid())
  phone      String?
  clientName String?
  time       String
  comment    String?
  userId     String?
  state      DirectsState?     @default(notConfirmed)
  services   DirectsServices[]
  calendarId String
  user       User?             @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  calendar   Calendar?         @relation(fields: [calendarId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@index([calendarId])
}

model Income_Expanses {
  id                   String               @id @default(uuid())
  categoryId           String
  type                 TypeOperation
  value                Float
  createDate           DateTime?            @default(now())
  updateDate           DateTime?
  userId               String
  categoryOperations   CategoryOperations   @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  user                 User                 @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model CategoryOperations {
  id                String              @id @default(uuid())
  name              String
  userId            String
  income_Expanses   Income_Expanses[]
  user              User                @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Category {
  id       String     @id @default(uuid())
  name     String     @db.VarChar(100)
  userId   String
  services Services[]
  user     User       @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model Services {
  id         String            @id @default(uuid())
  name       String            @db.VarChar(100)
  time       String
  price      Float
  directs    DirectsServices[]
  categoryId String
  category   Category          @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: Cascade)
}

model DirectsServices {
  serviceId String
  directId  String
  service   Services @relation(fields: [serviceId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  direct    Directs  @relation(fields: [directId], references: [id], onUpdate: Cascade, onDelete: Cascade)

  @@id([directId, serviceId])
  @@index([directId, serviceId])
}

enum TypeOperation {
  income
  expense
}

enum DirectsState {
  notConfirmed
  confirmed
  cancelled
}

enum DayState {
  empty
  full
  have
  notHave
}

enum Role {
  CLIENT
  ADMIN
  EMPLOYE
}
